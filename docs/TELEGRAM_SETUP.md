# Telegram Integration Setup for ZiggyAI

This guide explains how to set up Telegram notifications to receive real-time trading signals and alerts from ZiggyAI.

## Overview

ZiggyAI can send rich, detailed trading signals directly to your Telegram account, including:
- **Buy/Sell recommendations** with confidence scores
- **Detailed reasoning** from AI analysis
- **Price levels** (entry, stop loss, take profit)
- **Market regime context** (Panic, RiskOff, RiskOn, Chop)
- **Time horizons** with expiry timestamps
- **Technical indicators** (RSI, Z-score, trend analysis)
- **Risk/reward ratios**

## Prerequisites

- A Telegram account
- Access to create a Telegram bot (via @BotFather)
- Your Telegram chat ID

## Step 1: Create a Telegram Bot

1. Open Telegram and search for `@BotFather`
2. Start a chat and send the command: `/newbot`
3. Follow the prompts to:
   - Choose a name for your bot (e.g., "ZiggyAI Alerts")
   - Choose a username (e.g., "ziggyai_alerts_bot")
4. BotFather will provide you with a **Bot Token** - save this!
   - Example: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`

## Step 2: Get Your Chat ID

### Option A: Using @userinfobot (Recommended)
1. Search for `@userinfobot` in Telegram
2. Start a chat and send any message
3. The bot will reply with your Chat ID
4. Save this ID (it will be a number like `123456789`)

### Option B: Using your bot
1. Send a message to your newly created bot
2. Visit this URL in your browser (replace `YOUR_BOT_TOKEN`):
   ```
   https://api.telegram.org/botYOUR_BOT_TOKEN/getUpdates
   ```
3. Look for `"chat":{"id":XXXXXXXXX}` in the response
4. Save the ID number

## Step 3: Configure ZiggyAI

### Backend Configuration

1. Navigate to your backend directory:
   ```bash
   cd backend
   ```

2. Create or edit the `.env` file:
   ```bash
   # Telegram Configuration
   TELEGRAM_BOT_TOKEN=your_bot_token_here
   TELEGRAM_CHAT_ID=your_chat_id_here
   TELEGRAM_PARSE_MODE=Markdown
   
   # Scanner Configuration
   SCAN_SYMBOLS=AAPL,MSFT,NVDA,AMZN,GOOGL,META,TSLA
   SCAN_INTERVAL_S=60
   ZIGGY_SCAN_DEFAULT=1
   ```

3. Replace the placeholders:
   - `your_bot_token_here` ‚Üí Your bot token from BotFather
   - `your_chat_id_here` ‚Üí Your chat ID from step 2

### Configuration Options

- **TELEGRAM_BOT_TOKEN**: Your Telegram bot token (required)
- **TELEGRAM_CHAT_ID**: Your Telegram chat ID (required)
- **TELEGRAM_PARSE_MODE**: Message formatting (default: "Markdown")
- **SCAN_SYMBOLS**: Comma-separated list of symbols to monitor
- **SCAN_INTERVAL_S**: How often to scan for signals (in seconds)
- **ZIGGY_SCAN_DEFAULT**: Enable scanner on startup (1=enabled, 0=disabled)

## Step 4: Test the Connection

### Using the API

1. Start the ZiggyAI backend:
   ```bash
   cd backend
   python -m uvicorn app.main:app --reload
   ```

2. Test the Telegram connection:
   ```bash
   curl -X POST http://localhost:8000/alerts/ping/test
   ```

3. You should receive a test message in Telegram: "‚úÖ Ziggy alerts test"

### Using the Frontend

1. Start the frontend application
2. Navigate to the Alerts/Settings section
3. Click "Test Telegram Connection"
4. Check your Telegram for the test message

## Step 5: Enable Alert Scanning

### Via API
```bash
curl -X POST http://localhost:8000/alerts/start
```

### Via Frontend
1. Go to the Alerts dashboard
2. Toggle the "Scanner Enabled" switch to ON
3. The scanner will begin monitoring your configured symbols

## Message Types

### 1. Trading Signals
Sent when buy/sell opportunities are detected:
```
üü¢ üìà BUY SIGNAL üü¢

üéØ AAPL
üìä Confidence: 85% ‚≠ê‚≠ê‚≠ê‚≠ê
üî¨ Strategy: MeanReversion
üåä Market Regime: Chop

üí° Why this recommendation:
Mean reversion: RSI 28.5 oversold (< 30); Z-score -1.80 below -1.5

üí∞ Price Levels:
  ‚Ä¢ Entry: $150.00
  ‚Ä¢ Stop Loss: $145.00
  ‚Ä¢ Take Profit: $160.00
  ‚Ä¢ Risk/Reward: 1:2.0

‚è±Ô∏è Time Frame:
3D holding period
‚è∞ Valid until: 2025-11-13 14:30 UTC

üìä Key Indicators:
  ‚Ä¢ RSI(14): 28.5
  ‚Ä¢ Z-Score: -1.80

ü§ñ Generated by ZiggyAI at 2025-11-10 14:30:39 UTC
```

### 2. Market Regime Updates
Sent when market conditions change:
```
‚ö†Ô∏è MARKET REGIME UPDATE ‚ö†Ô∏è

üåê New Regime: RiskOff
üìä Confidence: 82%

üìã Key Indicators:
  ‚Ä¢ VIX > 25
  ‚Ä¢ SPX < MA200
  ‚Ä¢ Credit spreads widening

‚ÑπÔ∏è What this means:
Cautious market - defensive positioning recommended
```

### 3. Price Alerts
Sent when configured price levels are reached:
```
üîî ALERT TRIGGERED üîî

üéØ TSLA
üí∞ Price: $251.50
üìã Condition: price_above: 250.0

üí¨ TSLA crossed above $250 target
```

### 4. Heartbeat Messages
Periodic status updates:
- Daily: "Ziggy online ‚úÖ"
- Hourly: "üëç" (confirmation that backend is running)

## Troubleshooting

### No messages received

1. **Check bot token and chat ID**:
   ```bash
   curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getMe"
   ```
   Should return bot info.

2. **Verify environment variables**:
   ```bash
   cd backend
   python -c "import os; from dotenv import load_dotenv; load_dotenv(); print('Token:', os.getenv('TELEGRAM_BOT_TOKEN')[:10] + '...'); print('Chat ID:', os.getenv('TELEGRAM_CHAT_ID'))"
   ```

3. **Check backend logs**:
   ```bash
   # Look for Telegram-related messages
   grep -i telegram backend.log
   ```

### Messages not formatted correctly

- Ensure `TELEGRAM_PARSE_MODE` is set to `Markdown` or `HTML`
- Check backend logs for formatting errors
- Try sending a test message via API

### Scanner not running

1. Check scanner status:
   ```bash
   curl http://localhost:8000/alerts/status
   ```

2. Enable scanner:
   ```bash
   curl -X POST http://localhost:8000/alerts/start
   ```

3. Check `ZIGGY_SCAN_DEFAULT` in `.env`

## Advanced Configuration

### Custom Alert Rules

You can create custom alerts via the API:

```bash
curl -X POST http://localhost:8000/alerts/create \
  -H "Content-Type: application/json" \
  -d '{
    "symbol": "AAPL",
    "type": "price_above",
    "threshold": 150.0,
    "channels": ["telegram", "in_app"]
  }'
```

### Notification Frequency

Control how often you receive duplicate signals:

```bash
# In .env
ZIGGY_SIGNAL_MIN_GAP=900  # 15 minutes between repeat signals
```

### Multiple Chat IDs

To send to multiple Telegram accounts or groups:

1. Get chat IDs for each recipient
2. Set multiple chat IDs (comma-separated):
   ```bash
   TELEGRAM_CHAT_ID=123456789,987654321
   ```

## Security Best Practices

1. **Keep tokens secret**: Never commit `.env` files to version control
2. **Use environment variables**: Don't hardcode tokens in source code
3. **Restrict bot permissions**: Only give necessary permissions to your bot
4. **Monitor bot usage**: Regularly check who has access to your bot

## API Endpoints

- `POST /alerts/start` - Start the alert scanner
- `POST /alerts/stop` - Stop the alert scanner
- `GET /alerts/status` - Get scanner status
- `POST /alerts/ping/test` - Send test message
- `POST /alerts/create` - Create custom alert
- `GET /alerts/list` - List all alerts
- `DELETE /alerts/{alert_id}` - Delete an alert

## Support

For issues or questions:
1. Check the [main documentation](../README.md)
2. Review backend logs for errors
3. Open an issue on GitHub with:
   - Error messages
   - Configuration (redact sensitive tokens)
   - Steps to reproduce

## What's Next?

- Configure your watchlist symbols in `SCAN_SYMBOLS`
- Adjust `SCAN_INTERVAL_S` for your preferred update frequency
- Create custom alerts for specific price levels
- Monitor the market regime updates for context
- Review signal history in the frontend dashboard

Happy trading with ZiggyAI! üöÄ
